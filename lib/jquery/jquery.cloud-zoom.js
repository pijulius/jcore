(function(b){function n(g){for(var e=1;e<arguments.length;e++)g=g.replace("%"+(e-1),arguments[e]);return g}function H(g,e){var d=b("img",g),k,f=null,j=null,h=null,m=null,l=null,u=null,o,C=0,s,t,D=0,E=0,y=0,z=0,F=0,A,B,v=this,G;setTimeout(function(){if(j===null){var c=g.width();g.parent().append(n('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="cloud-zoom-loading" >Loading...</div>',c/3,c/2-c/6)).find(":last").css("opacity",0.5)}},200);this.removeBits=function(){if(h){h.remove();
h=null}if(m){m.remove();m=null}if(l){l.remove();l=null}if(u!==null){u.remove();u=null}b(".cloud-zoom-loading",g.parent()).remove()};this.destroy=function(){g.data("zoom",null);if(j){j.unbind();j.remove();j=null}if(f){f.remove();f=null}this.removeBits()};this.fadedOut=function(){if(f){f.remove();f=null}this.removeBits()};this.controlLoop=function(){if(h){var c=A-d.offset().left-s*0.5>>0,i=B-d.offset().top-t*0.5>>0;if(c<0)c=0;else if(c>d.outerWidth()-s)c=d.outerWidth()-s;if(i<0)i=0;else if(i>d.outerHeight()-
t)i=d.outerHeight()-t;h.css({left:c,top:i});h.css("background-position",-c+"px "+-i+"px");D=c/d.outerWidth()*o.width>>0;E=i/d.outerHeight()*o.height>>0;z+=(D-z)/e.smoothMove;y+=(E-y)/e.smoothMove;f.css("background-position",-(z>>0)+"px "+(-(y>>0)+"px"))}C=setTimeout(function(){v.controlLoop()},30)};this.init2=function(c,i){F++;if(i===1)o=c;F===2&&this.init()};this.init=function(){b(".cloud-zoom-loading",g.parent()).remove();j=g.parent().append(n("<div class='mousetrap' style='background-image:url(\".\");z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>",
d.outerWidth(),d.outerHeight(),0,0)).find(":last");j.bind("mousemove",this,function(c){A=c.pageX;B=c.pageY});j.bind("mouseleave",this,function(){clearTimeout(C);h&&h.fadeOut(299);m&&m.fadeOut(299);l&&l.fadeOut(299);f.fadeOut(300,function(){v.fadedOut()});return false});j.bind("mouseenter",this,function(c){A=c.pageX;B=c.pageY;G=c.data;if(f){f.stop(true,false);f.remove()}c=e.adjustX;var i=e.adjustY,w=d.outerWidth(),x=d.outerHeight(),p=e.zoomWidth,q=e.zoomHeight;if(e.zoomWidth=="auto")p=w;if(e.zoomHeight==
"auto")q=x;var r=g.parent();switch(e.position){case "top":i-=q;break;case "right":c+=w;break;case "bottom":i+=x;break;case "left":c-=p;break;case "inside":p=w;q=x;break;default:r=b("#"+e.position);if(r.length){p=r.innerWidth();q=r.innerHeight()}else{r=g;c+=w;i+=x}}f=r.append(n('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:99;"></div>',c,i,p,q,o.src)).find(":last");d.attr("title")&&
e.showTitle&&f.append(n('<div class="cloud-zoom-title">%0</div>',d.attr("title"))).find(":last").css("opacity",e.titleOpacity);if(b.browser.msie&&b.browser.version<7)u=b('<iframe frameborder="0" src="#"></iframe>').css({position:"absolute",left:c,top:i,zIndex:99,width:p,height:q}).insertBefore(f);f.fadeIn(500);if(h){h.remove();h=null}s=d.outerWidth()/o.width*f.width();t=d.outerHeight()/o.height*f.height();h=g.append(n("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>",
s,t)).find(":last");j.css("cursor",h.css("cursor"));c=false;if(e.tint){h.css("background",'url("'+d.attr("src")+'")');m=g.append(n('<div style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />',d.outerWidth(),d.outerHeight(),e.tint)).find(":last");m.css("opacity",e.tintOpacity);c=true;m.fadeIn(500)}if(e.softFocus){h.css("background",'url("'+d.attr("src")+'")');l=g.append(n('<div style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />',
d.outerWidth()-2,d.outerHeight()-2,e.tint)).find(":last");l.css("background",'url("'+d.attr("src")+'")');l.css("opacity",0.5);c=true;l.fadeIn(500)}c||h.css("opacity",e.lensOpacity);e.position!=="inside"&&h.fadeIn(500);G.controlLoop()})};k=new Image;b(k).load(function(){v.init2(this,0)});k.src=d.attr("src");k=new Image;b(k).load(function(){v.init2(this,1)});k.src=g.attr("href")}b(document).ready(function(){b(".cloud-zoom, .cloud-zoom-gallery").CloudZoom()});b.fn.CloudZoom=function(g){try{document.execCommand("BackgroundImageCache",
false,true)}catch(e){}this.each(function(){var d,k;eval("var\ta = {"+b(this).attr("rel")+"}");d=a;if(b(this).is(".cloud-zoom")){b(this).css({position:"relative",display:"block"});b("img",b(this)).css({display:"block"});b(this).parent().attr("id")!="wrap"&&b(this).wrap('<div id="wrap" style="top:0px;z-index:9999;position:relative;"></div>');k=b.extend({},b.fn.CloudZoom.defaults,g);k=b.extend({},k,d);b(this).data("zoom",new H(b(this),k))}else if(b(this).is(".cloud-zoom-gallery")){k=b.extend({},d,g);
b(this).data("relOpts",k);b(this).bind("click",b(this),function(f){var j=f.data.data("relOpts");b("#"+j.useZoom).data("zoom").destroy();b("#"+j.useZoom).attr("href",f.data.attr("href"));b("#"+j.useZoom+" img").attr("src",f.data.data("relOpts").smallImage);b("#"+f.data.data("relOpts").useZoom).CloudZoom();return false})}});return this};b.fn.CloudZoom.defaults={zoomWidth:"auto",zoomHeight:"auto",position:"right",tint:false,tintOpacity:0.5,lensOpacity:0.5,softFocus:false,smoothMove:3,showTitle:true,
titleOpacity:0.5,adjustX:0,adjustY:0}})(jQuery);
